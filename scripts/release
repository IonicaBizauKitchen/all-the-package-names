#!/usr/bin/env bash

if [ ! -f "skimdb.json" ]
then
  npm run download
elif test `find "skimdb.json" -mmin +30`
then
  npm run download
fi

npm run extract

status=$(git status names.json 2>&1)

if [[ "$status" =~ "modified:" ]]
then
  count=$(cat names.json | wc -l)
  echo "$count package names!"
  git add names.json
  git commit -m "$count package names"
  npm version minor -m "$count package names"
  npm publish
  git remote add zeke https://github.com/zeke/all-the-package-names
  git push zeke master --follow-tags
else
  echo "no new names"
fi
